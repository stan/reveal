(function (a) { var b = { animation: "fadeAndPop", animationSpeed: 300, closeOnBackgroundClick: true, closeOnKey: 27, closeOnTimeout: false, dismissModalClass: "close-reveal-modal" }; a("a[data-reveal-id]").live("click", function (b) { b.preventDefault(); a("#" + a(this).attr("data-reveal-id")).reveal(a(this).data()) }); a.fn.reveal = function (c) { return this.each(function () { var d = a(this), e = parseInt(d.css("top")), f = d.height() + e, g = false, h = a(".reveal-modal-bg"), i = null, j = a.extend({}, b, c); d.bind("reveal:open", function () { if (h.length == 0) h = a('<div class="reveal-modal-bg" />').insertAfter(d).fadeTo("fast", .8); if (!g) { g = true; d.css({ opacity: 0, top: a(document).scrollTop() + e, visibility: "visible" }); if (j.animation == "fadeAndPop") { d.css({ top: a(document).scrollTop() - e }); d.delay(j.animationSpeed / 2).animate({ top: a(document).scrollTop() + e + "px", opacity: 1 }, j.animationSpeed) } else if (j.animation == "fade") { d.delay(j.animationSpeed / 2).animate({ opacity: 1 }, j.animationSpeed) } else if (j.animation == "none") { d.css({ opacity: 1 }); j.animationSpeed = 0 } h.fadeIn(j.animationSpeed / 2) } if (j.closeOnBackgroundClick) { h.css({ cursor: "pointer" }).bind("click.modalEvent", function () { d.trigger("reveal:close") }) } if (j.closeOnKey) { a("body").keyup(function (a) { if (a.which === j.closeOnKey) d.trigger("reveal:close") }) } d.find("." + j.dismissModalClass).live("click.modalEvent", function () { d.trigger("reveal:close") }); g = false; d.unbind("reveal:open") }); d.bind("reveal:close", function () { if (!g) { g = true; if (j.animation == "fadeAndPop") { d.animate({ top: a(document).scrollTop() - f + "px", opacity: 0 }, j.animationSpeed / 2, function () { d.css({ top: e, opacity: 1, visibility: "hidden" }) }) } else if (j.animation == "fade") { d.animate({ opacity: 0 }, j.animationSpeed, function () { d.css({ opacity: 1, visibility: "hidden", top: e }) }) } else if (j.animation == "none") { d.css({ visibility: "hidden", top: e }); j.animationSpeed = 0 } h.delay(j.animationSpeed).fadeOut(j.animationSpeed) } clearTimeout(i); g = false; d.unbind("reveal:close") }); d.trigger("reveal:open"); if (j.closeOnTimeout) i = setTimeout(function () { d.trigger("reveal:close") }, j.closeOnTimeout) }) } })(jQuery)
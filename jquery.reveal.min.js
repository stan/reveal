(function ($) { var defaults = { animation: "fadeAndPop", animationSpeed: 300, closeOnBackgroundClick: true, closeOnKey: 27, closeOnTimeout: false, dismissModalClass: "close-reveal-modal", dismissCallback: null }; $("a[data-reveal-id]").live("click", function (a) { a.preventDefault(); $("#" + $(this).attr("data-reveal-id")).reveal($(this).data()) }); $.fn.reveal = function (args) { return this.each(function () { var modal = $(this), topMeasure = parseInt(modal.css("top")), topOffset = modal.height() + topMeasure, locked = false, background = $(".reveal-modal-bg"), timeout = null, options = $.extend({}, defaults, args); modal.bind("reveal:open", function () { if (background.length == 0) background = $('<div class="reveal-modal-bg" />').insertAfter(modal).fadeTo("fast", .8); if (!locked) { locked = true; modal.css({ opacity: 0, top: $(document).scrollTop() + topMeasure, visibility: "visible" }); if (options.animation == "fadeAndPop") { modal.css({ top: $(document).scrollTop() - topMeasure }); modal.delay(options.animationSpeed / 2).animate({ top: $(document).scrollTop() + topMeasure + "px", opacity: 1 }, options.animationSpeed) } else if (options.animation == "fade") { modal.delay(options.animationSpeed / 2).animate({ opacity: 1 }, options.animationSpeed) } else if (options.animation == "none") { modal.css({ opacity: 1 }); options.animationSpeed = 0 } background.fadeIn(options.animationSpeed / 2) } if (options.closeOnBackgroundClick) { background.css({ cursor: "pointer" }).bind("click.modalEvent", function () { modal.trigger("reveal:close") }) } if (options.closeOnKey) { $("body").keyup(function (a) { if (a.which === options.closeOnKey) modal.trigger("reveal:close") }) } modal.find("." + options.dismissModalClass).live("click.modalEvent", function () { modal.trigger("reveal:close") }); locked = false; modal.unbind("reveal:open") }); modal.bind("reveal:close", function () { if (!locked) { locked = true; if (options.animation == "fadeAndPop") { modal.animate({ top: $(document).scrollTop() - topOffset + "px", opacity: 0 }, options.animationSpeed / 2, function () { modal.css({ top: topMeasure, opacity: 1, visibility: "hidden" }) }) } else if (options.animation == "fade") { modal.animate({ opacity: 0 }, options.animationSpeed, function () { modal.css({ opacity: 1, visibility: "hidden", top: topMeasure }) }) } else if (options.animation == "none") { modal.css({ visibility: "hidden", top: topMeasure }); options.animationSpeed = 0 } background.delay(options.animationSpeed).fadeOut(options.animationSpeed, function () { eval(options.dismissCallback) }) } clearTimeout(timeout); locked = false; modal.unbind("reveal:close") }); modal.trigger("reveal:open"); if (options.closeOnTimeout) timeout = setTimeout(function () { modal.trigger("reveal:close") }, options.closeOnTimeout) }) } })(jQuery)